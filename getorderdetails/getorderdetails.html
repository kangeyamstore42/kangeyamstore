<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Lookup</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background: #fff;
      max-width: 800px;
      width: 95%;
      margin: 40px auto;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    input[type="text"] {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border: 1.5px solid #ccc;
      border-radius: 6px;
    }

    input[type="text"]:focus {
      border-color: #2980b9;
      outline: none;
      box-shadow: 0 0 5px rgba(41,128,185,0.5);
    }

    button {
      margin-top: 15px;
      width: 100%;
      padding: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 6px;
      background-color: #2980b9;
      color: #fff;
      cursor: pointer;
      transition: background 0.25s ease;
    }

    button:hover {
      background-color: #1f6391;
    }

    #result {
      margin-top: 25px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #f0f3f6;
      width: 30%;
    }

    tr:hover { background-color: #f9f9f9; }

    .error {
      color: red;
      font-weight: bold;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Order Details Lookup</h1>

    <label for="orderId">Enter Order ID:</label>
    <input id="orderId" type="text" placeholder="e.g. KS1208172345" />

    <button onclick="lookup()">Search</button>

    <div id="result"></div>
  </div>

  <script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpZ1Ji6OqOvt3KfY3rg5dLedFCOFt4nawZNzwsjK_fScUmaWeSHX7Fm0G8Kw6QdpkH/exec";

  function lookup() {
    const orderId = document.getElementById("orderId").value.trim();
    const resultEl = document.getElementById("result");
    resultEl.innerHTML = "";

    if (!orderId) {
      alert("Please enter an Order ID.");
      return;
    }

    resultEl.innerHTML = "<p>üîç Searching...</p>";

    fetch(`${SCRIPT_URL}?orderID=${encodeURIComponent(orderId)}`)
      .then(res => res.json())
      .then(data => {
        resultEl.innerHTML = "";

        if (!data || data.error) {
          resultEl.innerHTML = `<p class="error">${data.error || "Order not found."}</p>`;
          return;
        }

        let table = "<table>";

        for (let key in data) {
          let value = data[key];

          // Skip empty cancel_reason & cancel_date
          if ((key === "cancel_reason" || key === "cancel_date") && (!value || String(value).trim() === "")) {
            continue;
          }

          // Format product_details specially
          if (key === "product_details") {
            table += `
              <tr>
                <th>Product Details</th>
                <td>${formatProductDetails(value)}</td>
              </tr>`;
          } else {
            table += `
              <tr>
                <th>${prettyLabel(key)}</th>
                <td>${escapeHtml(value)}</td>
              </tr>`;
          }
        }

        table += "</table>";
        resultEl.innerHTML = table;
      })
      .catch(err => {
        console.error(err);
        resultEl.innerHTML = "<p class='error'>‚ö†Ô∏è Error fetching details.</p>";
      });
  }

  // Format header names to be human readable
  function prettyLabel(key) {
    return key
      .replace(/_/g, " ")          // replace underscores
      .replace(/\b\w/g, l => l.toUpperCase()); // capitalize words
  }

  // Special product details formatting
  function formatProductDetails(details) {
    if (!details) return "";

    // Split products if multiple
    const items = details.split(/(?=Product Code:)/);

    let html = "<ul style='padding-left:16px;'>";
    items.forEach(item => {
      const clean = item.trim();
      if (!clean) return;

      // Break into parts
      html += `<li>${escapeHtml(clean)}</li>`;
    });
    html += "</ul>";
    return html;
  }

  function escapeHtml(str) {
    if (str === null || str === undefined) return "";
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }
</script>

</body>
</html>
